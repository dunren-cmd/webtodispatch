# Web App 部署說明

## ⚠️ 重要：部署是指 Google Apps Script 的 Web App 部署

**部署不是指試算表！** 部署是指將 Google Apps Script 的程式碼發布為 Web App，讓前端可以透過 HTTP 請求來呼叫。

---

## 📋 部署步驟

### 步驟 1：確認 Code.gs 已儲存

1. 在 Google Apps Script 編輯器中
2. 確認 `Code.gs` 內容已正確貼上
3. 點擊「儲存」（💾 圖示或 `Ctrl+S`）

### 步驟 2：部署為 Web App

1. 點擊右上角的「部署」
2. 選擇「新增部署作業」或「管理部署作業」
   - 如果是第一次部署：選擇「新增部署作業」
   - 如果已經部署過：選擇「管理部署作業」→ 點擊「編輯」（鉛筆圖示）

### 步驟 3：設定部署選項

1. **選擇類型**：
   - 點擊「選取類型」
   - 選擇「網頁應用程式」

2. **設定說明**：
   - **說明**：可以輸入「任務交辦系統 API v1」（可選）
   - **執行身分**：選擇「我」
   - **具有存取權的使用者**：**必須選擇「任何人」** ⚠️ 這很重要！

3. 點擊「部署」

### 步驟 4：授權應用程式（首次部署）

1. 首次部署會要求授權
2. 點擊「授權存取權限」
3. 選擇你的 Google 帳號
4. 點擊「進階」→「前往 [專案名稱]（不安全）」
5. 點擊「允許」

### 步驟 5：取得 Web App URL

1. 部署成功後，會顯示「網頁應用程式網址」
2. **複製這個 URL**，例如：
   ```
   https://script.google.com/macros/s/AKfycbzpdPkr96-Kc36TAYU3poKqOw2Do6GpXi6AMgJWgUDft9uD8EBoGyw4-VRJOgiiMAqZKw/exec
   ```

### 步驟 6：更新前端 API URL

1. 開啟 `api.ts` 檔案
2. 找到這一行：
   ```typescript
   const API_URL = '你的 Web App URL';
   ```
3. 將 URL 更新為剛才複製的 Web App URL

---

## 🔄 重新部署（修改 Code.gs 後）

**重要**：每次修改 `Code.gs` 後，都需要重新部署！

1. 在 Google Apps Script 編輯器中
2. 點擊「部署」→「管理部署作業」
3. 點擊現有部署旁的「編輯」（鉛筆圖示）
4. 選擇「新版本」
5. 點擊「部署」
6. **確認 Web App URL 是否變更**（通常不會變，但建議確認）

---

## ✅ 部署檢查清單

- [ ] Code.gs 已儲存到 Google Apps Script
- [ ] Web App 已部署
- [ ] 部署設定中「具有存取權的使用者」選擇「任何人」
- [ ] Web App URL 已複製
- [ ] 前端 `api.ts` 中的 `API_URL` 已更新
- [ ] 可以在瀏覽器中訪問 Web App URL（應該看到 JSON 回應）

---

## 🧪 測試部署是否成功

### 方法 1：瀏覽器測試

在瀏覽器中訪問你的 Web App URL：
```
https://script.google.com/macros/s/YOUR_WEB_APP_ID/exec
```

應該看到：
```json
{
  "message": "任務交辦系統 API 服務運行中",
  "timestamp": "..."
}
```

### 方法 2：帶參數測試

訪問：
```
https://script.google.com/macros/s/YOUR_WEB_APP_ID/exec?action=getUsers
```

應該看到員工列表的 JSON 回應。

---

## 🐛 常見問題

### Q1: 為什麼要選擇「任何人」？

A: Google Apps Script Web App 只有在選擇「任何人」時，才會自動處理 CORS headers，讓前端可以正常呼叫 API。如果選擇「只有我」，瀏覽器會阻擋跨域請求。

### Q2: 選擇「任何人」會不會有安全問題？

A: 不會。因為：
- 只有知道 Web App URL 的人才能存取
- 你可以在 `Code.gs` 中加入身份驗證邏輯
- Google Apps Script 會記錄所有請求

### Q3: 修改 Code.gs 後需要重新部署嗎？

A: **是的！** 每次修改 `Code.gs` 後都需要：
1. 儲存檔案
2. 重新部署 Web App（選擇「新版本」）

### Q4: Web App URL 會變嗎？

A: 通常不會變，但建議每次部署後都確認一下 URL。

---

## 📞 需要協助？

如果部署後仍然無法連接，請檢查：
1. Web App URL 是否正確
2. 部署設定中是否選擇「任何人」
3. 瀏覽器 Console 的錯誤訊息
4. Google Apps Script 執行記錄

