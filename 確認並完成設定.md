# ç¢ºèªä¸¦å®Œæˆè¨­å®š

## âœ… å•é¡Œå·²è§£æ±º

æ‚¨å·²ç¶“æ‰¾åˆ°åŸå› ï¼šå»ºç«‹çš„ ID æ¬„ä½èˆ‡ç³»çµ±çš„ id æ¬„ä½ä¸åŒï¼Œç¾åœ¨ç³»çµ±å·²ç¶“è‡ªå‹•ç”Ÿæˆäº† id å€¼ã€‚

---

## ğŸ” ç¢ºèªç•¶å‰ç‹€æ…‹

### æ­¥é©Ÿ 1ï¼šæª¢æŸ¥ PersonnelData è¡¨çš„çµæ§‹

åœ¨ SQL Editor åŸ·è¡Œï¼š

```sql
SELECT column_name, data_type, is_nullable
FROM information_schema.columns 
WHERE table_schema = 'public' 
  AND table_name = 'PersonnelData'
ORDER BY ordinal_position;
```

ç¢ºèªï¼š
- âœ… æœ‰ `id` æ¬„ä½
- âœ… æœ‰ `employee_id` æ¬„ä½
- âœ… id æ¬„ä½å·²ç¶“æœ‰å€¼

### æ­¥é©Ÿ 2ï¼šæª¢æŸ¥ id æ˜¯å¦éƒ½å·²ç”Ÿæˆ

```sql
SELECT 
  COUNT(*) as total_records,
  COUNT(id) as records_with_id,
  COUNT(*) - COUNT(id) as records_without_id
FROM "PersonnelData";
```

æ‡‰è©²çœ‹åˆ° `records_without_id` ç‚º 0ã€‚

### æ­¥é©Ÿ 3ï¼šæŸ¥çœ‹è³‡æ–™

```sql
SELECT id, employee_id, name, email 
FROM "PersonnelData" 
ORDER BY id;
```

ç¢ºèªæ‰€æœ‰è¨˜éŒ„éƒ½æœ‰ id å€¼ã€‚

---

## ğŸ”— å®Œæˆ users å’Œ PersonnelData çš„é—œè¯

### æ­¥é©Ÿ 1ï¼šç¢ºèª users è¡¨æœ‰ employee_id æ¬„ä½

```sql
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_schema = 'public' 
  AND table_name = 'users'
ORDER BY ordinal_position;
```

å¦‚æœæ²’æœ‰ `employee_id` æ¬„ä½ï¼ŒåŸ·è¡Œï¼š

```sql
ALTER TABLE users ADD COLUMN IF NOT EXISTS employee_id TEXT;
CREATE INDEX IF NOT EXISTS idx_users_employee_id ON users(employee_id);
```

### æ­¥é©Ÿ 2ï¼šå»ºç«‹è¦–åœ–ï¼ˆæ–¹ä¾¿æŸ¥è©¢ï¼‰

```sql
CREATE OR REPLACE VIEW user_with_personnel AS
SELECT 
  u.id as user_id,
  u.name,
  u.role,
  u.employee_id,
  p.id as personnel_id,
  p.employee_id as personnel_employee_id,
  p.email,
  p.drive_link
FROM users u
LEFT JOIN "PersonnelData" p ON u.employee_id = p.employee_id;
```

### æ­¥é©Ÿ 3ï¼šæ¸¬è©¦è¦–åœ–

```sql
SELECT * FROM user_with_personnel LIMIT 5;
```

---

## ğŸ§ª æ¸¬è©¦ Email é€šçŸ¥åŠŸèƒ½

### æ­¥é©Ÿ 1ï¼šç¢ºèªé—œè¯

åœ¨ users è¡¨ä¸­è¨­å®š employee_idï¼Œä¾‹å¦‚ï¼š

```sql
-- ç¯„ä¾‹ï¼šå°‡ users.id=1 é—œè¯åˆ° PersonnelData.employee_id='0022'
UPDATE users 
SET employee_id = '0022' 
WHERE id = 1;
```

**æ³¨æ„ï¼š** è«‹æ ¹æ“šå¯¦éš›çš„ users å’Œ PersonnelData è³‡æ–™ä¾†è¨­å®šé—œè¯ã€‚

### æ­¥é©Ÿ 2ï¼šæ¸¬è©¦å–å¾— email

åœ¨ Google Apps Script ç·¨è¼¯å™¨ä¸­åŸ·è¡Œï¼š

```javascript
testGetUserEmail();
```

é€™æœƒæ¸¬è©¦æ˜¯å¦èƒ½å¾ PersonnelData å–å¾— emailã€‚

### æ­¥é©Ÿ 3ï¼šæ¸¬è©¦ç™¼é€ Chat é€šçŸ¥

```javascript
testSendEmailToChimi();
```

é€™æœƒç™¼é€æ¸¬è©¦ email åˆ° `chimi951@gmail.com`ã€‚

---

## ğŸ“‹ æª¢æŸ¥æ¸…å–®

- [x] PersonnelData è¡¨çš„ id æ¬„ä½å·²ç”Ÿæˆ
- [ ] users è¡¨æœ‰ employee_id æ¬„ä½
- [ ] users å’Œ PersonnelData å·²æ­£ç¢ºé—œè¯ï¼ˆusers.employee_id = PersonnelData.employee_idï¼‰
- [ ] è¦–åœ– `user_with_personnel` å·²å»ºç«‹
- [ ] æ¸¬è©¦å–å¾— email åŠŸèƒ½
- [ ] æ¸¬è©¦ç™¼é€ Chat é€šçŸ¥

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **ç¢ºèªé—œè¯**ï¼šåœ¨ users è¡¨ä¸­è¨­å®š employee_idï¼Œå°æ‡‰åˆ° PersonnelData çš„ employee_id
2. **æ¸¬è©¦ email é€šçŸ¥**ï¼šåŸ·è¡Œ `testSendEmailToChimi()` æ¸¬è©¦ Chat é€šçŸ¥
3. **å¯¦éš›æ¸¬è©¦**ï¼šå»ºç«‹ä¸€å€‹ä»»å‹™ï¼Œç¢ºèªæœƒè‡ªå‹•ç™¼é€ email é€šçŸ¥

---

**å¦‚æœé‚„æœ‰å•é¡Œï¼Œè«‹å‘Šè¨´æˆ‘ï¼**
