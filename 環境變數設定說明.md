# 環境變數設定說明

## 快速開始

### 1. 複製環境變數範本

```bash
# Windows
copy .env.example .env

# Linux/Mac
cp .env.example .env
```

### 2. 編輯 .env 文件

根據你的環境修改以下配置：

```env
# Supabase 配置
VITE_SUPABASE_URL=http://192.168.62.101:54321
VITE_SUPABASE_ANON_KEY=sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH

# 前端應用程式配置
VITE_APP_PORT=3050
VITE_APP_HOST=0.0.0.0
```

### 3. 啟動 Supabase（如果使用本地 Supabase）

```bash
supabase start
```

### 4. 執行資料庫遷移

```bash
# 確保所有遷移文件都已執行
supabase migration up
```

或在 Supabase Studio 中手動執行所有遷移文件。

### 5. 啟動前端應用

```bash
npm install
npm run dev
```

## 環境變數說明

### VITE_SUPABASE_URL

Supabase API 服務的 URL。

**本地開發：**
```env
VITE_SUPABASE_URL=http://192.168.62.101:54321
```

**其他環境：**
```env
VITE_SUPABASE_URL=http://你的IP:54321
```

### VITE_SUPABASE_ANON_KEY

Supabase 的匿名 API Key（Publishable Key）。

**取得方式：**
```bash
supabase status
```

在輸出中找到 `API URL` 和 `anon key`。

### VITE_APP_PORT

前端應用程式的端口號。

**預設值：** `3050`

**修改範例：**
```env
VITE_APP_PORT=3000
```

### VITE_APP_HOST

前端應用程式綁定的主機位址。

**預設值：** `0.0.0.0`（允許外部訪問）

**僅本地訪問：**
```env
VITE_APP_HOST=localhost
```

## 不同環境的配置

### 開發環境（本地）

```env
VITE_SUPABASE_URL=http://192.168.62.101:54321
VITE_SUPABASE_ANON_KEY=sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH
VITE_APP_PORT=3050
VITE_APP_HOST=0.0.0.0
```

### 測試環境

```env
VITE_SUPABASE_URL=http://192.168.1.100:54321
VITE_SUPABASE_ANON_KEY=你的測試環境Key
VITE_APP_PORT=3050
VITE_APP_HOST=0.0.0.0
```

### 生產環境

```env
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=你的生產環境Key
VITE_APP_PORT=3050
VITE_APP_HOST=0.0.0.0
```

## 確保資料庫資料一致

### 步驟 1：執行所有遷移文件

確保所有 Supabase 遷移文件都已執行：

```bash
# 檢查遷移狀態
supabase migration list

# 執行所有未執行的遷移
supabase migration up
```

### 步驟 2：檢查資料庫結構

在 Supabase Studio 中執行：

```sql
-- 檢查表是否存在
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public'
ORDER BY table_name;

-- 應該看到：
-- - users
-- - tasks
-- - roles
```

### 步驟 3：驗證關聯

```sql
-- 檢查外鍵約束
SELECT
  tc.constraint_name,
  tc.table_name,
  kcu.column_name,
  ccu.table_name AS foreign_table_name,
  ccu.column_name AS foreign_column_name
FROM information_schema.table_constraints AS tc
JOIN information_schema.key_column_usage AS kcu
  ON tc.constraint_name = kcu.constraint_name
JOIN information_schema.constraint_column_usage AS ccu
  ON ccu.constraint_name = tc.constraint_name
WHERE tc.constraint_type = 'FOREIGN KEY'
  AND tc.table_schema = 'public';
```

## 常見問題

### Q1: 如何取得 Supabase URL 和 Key？

**A:** 執行 `supabase status`，會顯示：
```
API URL: http://192.168.62.101:54321
anon key: sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH
```

### Q2: 為什麼要使用環境變數？

**A:** 
- 不同環境可以使用不同的配置
- 不需要修改程式碼
- 敏感資訊不會提交到 Git

### Q3: .env 文件會被提交到 Git 嗎？

**A:** 不會。`.env` 已在 `.gitignore` 中排除。`.env.example` 會提交，作為範本。

### Q4: 如何確保資料庫資料一致？

**A:** 
1. 確保所有遷移文件都在 `supabase/migrations/` 目錄中
2. 執行 `supabase migration up` 執行所有遷移
3. 檢查遷移狀態：`supabase migration list`

### Q5: 如果 Supabase 在不同 IP 怎麼辦？

**A:** 修改 `.env` 文件中的 `VITE_SUPABASE_URL`：
```env
VITE_SUPABASE_URL=http://新的IP:54321
```

然後重新啟動前端應用。

## 檢查清單

- [ ] 複製 `.env.example` 為 `.env`
- [ ] 修改 `.env` 中的 Supabase URL 和 Key
- [ ] 執行 `supabase start`（如果使用本地 Supabase）
- [ ] 執行 `supabase migration up` 執行所有遷移
- [ ] 執行 `npm install` 安裝依賴
- [ ] 執行 `npm run dev` 啟動應用
- [ ] 檢查瀏覽器控制台確認配置正確
