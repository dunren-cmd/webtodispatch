# 測試函數除錯指南

## 🔍 測試函數執行失敗的常見原因

### 1. 權限問題

**錯誤訊息**：
- `您沒有權限執行此操作`
- `無法開啟試算表`

**解決方案**：
1. 確認 Google Apps Script 專案有權限存取 Google Sheets
2. 首次執行時會要求授權，請點擊「授權」
3. 確認試算表 ID 正確
4. 確認試算表已分享給執行腳本的帳號

### 2. 試算表 ID 錯誤

**錯誤訊息**：
- `找不到試算表`
- `無法開啟試算表`

**解決方案**：
1. 檢查 `Code.gs` 中的 `SPREADSHEET_ID` 是否正確
2. 確認試算表網址中的 ID 是否與程式碼中的一致

### 3. 工作表名稱錯誤

**錯誤訊息**：
- `找不到工作表`
- `工作表不存在`

**解決方案**：
1. 確認工作表名稱是否正確
2. 目前的工作表名稱：
   - `交辦紀錄` - 任務資料
   - `人員管理_交辦` - 員工資料
3. 如果工作表不存在，程式會自動建立

### 4. 資料格式錯誤

**錯誤訊息**：
- `JSON 解析錯誤`
- `資料格式不正確`

**解決方案**：
1. 檢查測試函數中的資料格式
2. 確認所有必填欄位都有值

## 📝 檢查清單

執行測試函數前，請確認：

- [ ] Google Apps Script 專案已授權存取 Google Sheets
- [ ] `SPREADSHEET_ID` 正確
- [ ] 試算表已存在且可存取
- [ ] 工作表名稱正確（`交辦紀錄`、`人員管理_交辦`）
- [ ] 測試函數中的資料格式正確

## 🔧 除錯步驟

### 步驟 1：檢查執行記錄

1. 在 Google Apps Script 編輯器中
2. 點擊「檢視」→「執行記錄」
3. 查看詳細的錯誤訊息

### 步驟 2：檢查試算表

1. 開啟 Google Sheets
2. 確認試算表 ID 是否正確
3. 確認工作表是否存在

### 步驟 3：測試基本功能

先執行最簡單的測試函數：
```javascript
function testBasic() {
  const ss = SpreadsheetApp.openById(SPREADSHEET_ID);
  Logger.log('試算表名稱：' + ss.getName());
  Logger.log('工作表數量：' + ss.getSheets().length);
}
```

如果這個函數可以執行，表示權限和試算表 ID 都沒問題。

### 步驟 4：檢查工作表名稱

```javascript
function testSheetNames() {
  const ss = SpreadsheetApp.openById(SPREADSHEET_ID);
  const sheets = ss.getSheets();
  sheets.forEach(function(sheet) {
    Logger.log('工作表名稱：' + sheet.getName());
  });
}
```

執行這個函數可以查看試算表中所有工作表的名稱。

## 🎯 常見錯誤解決方案

### 錯誤 1：找不到試算表

**可能原因**：
- 試算表 ID 錯誤
- 試算表未分享給執行腳本的帳號

**解決方案**：
1. 確認試算表 ID 正確
2. 在 Google Sheets 中，點擊「共用」→ 分享給執行腳本的 Google 帳號

### 錯誤 2：找不到工作表

**可能原因**：
- 工作表名稱錯誤
- 工作表不存在

**解決方案**：
1. 確認工作表名稱是否正確（注意大小寫和特殊字元）
2. 如果工作表不存在，程式會自動建立
3. 可以手動建立工作表並命名為正確的名稱

### 錯誤 3：權限不足

**可能原因**：
- 首次執行未授權
- 授權被撤銷

**解決方案**：
1. 重新執行測試函數
2. 點擊「授權」按鈕
3. 選擇執行腳本的 Google 帳號
4. 點擊「進階」→「前往 [專案名稱]（不安全）」
5. 點擊「允許」

## 📞 需要協助？

如果以上步驟都無法解決問題，請提供：
1. 執行記錄的完整錯誤訊息
2. 測試函數的名稱
3. 試算表 ID（可以遮住部分字元）
4. 工作表名稱

