# é–‹æ©Ÿè‡ªå‹•å•Ÿå‹•è¨­å®šèªªæ˜

æœ¬æ–‡ä»¶èªªæ˜å¦‚ä½•è¨­å®š WebToDispatch å°ˆæ¡ˆåœ¨ç³»çµ±é–‹æ©Ÿæ™‚è‡ªå‹•å•Ÿå‹•ã€‚

## ğŸ“‹ å‰ç½®éœ€æ±‚

1. **å·²å®‰è£ Node.js å’Œ npm**
   ```bash
   node --version
   npm --version
   ```

2. **å·²å®‰è£ Supabase CLI**
   ```bash
   supabase --version
   ```

3. **å·²è¨­å®šç’°å¢ƒè®Šæ•¸**
   - ç¢ºèª `.env` æ–‡ä»¶å­˜åœ¨ä¸¦å·²æ­£ç¢ºé…ç½®
   - å¦‚æœä¸å­˜åœ¨ï¼Œå¾ `.env.example` è¤‡è£½ä¸¦ç·¨è¼¯

4. **å·²å®‰è£å°ˆæ¡ˆä¾è³´**
   ```bash
   npm install
   ```

## ğŸš€ å®‰è£æ­¥é©Ÿ

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨è‡ªå‹•å®‰è£è…³æœ¬ï¼ˆæ¨è–¦ï¼‰

1. **åŸ·è¡Œå®‰è£è…³æœ¬**
   ```bash
   sudo ./å®‰è£é–‹æ©Ÿè‡ªå‹•å•Ÿå‹•.sh
   ```

2. **è…³æœ¬æœƒè‡ªå‹•å®Œæˆä»¥ä¸‹æ“ä½œï¼š**
   - è¤‡è£½æœå‹™æ–‡ä»¶åˆ° systemd ç›®éŒ„
   - é‡æ–°è¼‰å…¥ systemd é…ç½®
   - å•Ÿç”¨é–‹æ©Ÿè‡ªå‹•å•Ÿå‹•
   - å¯é¸ï¼šç«‹å³å•Ÿå‹•æœå‹™

### æ–¹æ³•äºŒï¼šæ‰‹å‹•å®‰è£

1. **è¤‡è£½æœå‹™æ–‡ä»¶**
   ```bash
   sudo cp webtodispatch.service /etc/systemd/system/
   ```

2. **ç¢ºä¿å•Ÿå‹•è…³æœ¬æœ‰åŸ·è¡Œæ¬Šé™**
   ```bash
   chmod +x start_service.sh
   ```

3. **é‡æ–°è¼‰å…¥ systemd**
   ```bash
   sudo systemctl daemon-reload
   ```

4. **å•Ÿç”¨é–‹æ©Ÿè‡ªå‹•å•Ÿå‹•**
   ```bash
   sudo systemctl enable webtodispatch.service
   ```

5. **å•Ÿå‹•æœå‹™ï¼ˆå¯é¸ï¼‰**
   ```bash
   sudo systemctl start webtodispatch.service
   ```

## ğŸ“ æœå‹™ç®¡ç†å‘½ä»¤

### å•Ÿå‹•æœå‹™
```bash
sudo systemctl start webtodispatch
```

### åœæ­¢æœå‹™
```bash
sudo systemctl stop webtodispatch
```

### é‡å•Ÿæœå‹™
```bash
sudo systemctl restart webtodispatch
```

### æŸ¥çœ‹æœå‹™ç‹€æ…‹
```bash
sudo systemctl status webtodispatch
```

### æŸ¥çœ‹æœå‹™æ—¥èªŒ

**æ–¹æ³•ä¸€ï¼šä½¿ç”¨ journalctlï¼ˆæ¨è–¦ï¼‰**
```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥èªŒ
sudo journalctl -u webtodispatch

# å³æ™‚æŸ¥çœ‹æ—¥èªŒï¼ˆé¡ä¼¼ tail -fï¼‰
sudo journalctl -u webtodispatch -f

# æŸ¥çœ‹æœ€è¿‘çš„ 100 è¡Œæ—¥èªŒ
sudo journalctl -u webtodispatch -n 100
```

**æ–¹æ³•äºŒï¼šæŸ¥çœ‹æœå‹™æ—¥èªŒæ–‡ä»¶**
```bash
tail -f /home/dunren/cursor/webtodispatch/WebToDispatch_2/service.log
```

### ç¦ç”¨é–‹æ©Ÿè‡ªå‹•å•Ÿå‹•
```bash
sudo systemctl disable webtodispatch
```

### å•Ÿç”¨é–‹æ©Ÿè‡ªå‹•å•Ÿå‹•
```bash
sudo systemctl enable webtodispatch
```

## ğŸ” æ•…éšœæ’é™¤

### å•é¡Œ 1ï¼šæœå‹™ç„¡æ³•å•Ÿå‹•

**æª¢æŸ¥æœå‹™ç‹€æ…‹ï¼š**
```bash
sudo systemctl status webtodispatch
```

**æŸ¥çœ‹è©³ç´°éŒ¯èª¤è¨Šæ¯ï¼š**
```bash
sudo journalctl -u webtodispatch -n 50
```

**å¸¸è¦‹åŸå› ï¼š**
- `.env` æ–‡ä»¶ä¸å­˜åœ¨æˆ–é…ç½®éŒ¯èª¤
- `node_modules` æœªå®‰è£
- Supabase ç„¡æ³•å•Ÿå‹•
- ç«¯å£è¢«å ç”¨

### å•é¡Œ 2ï¼šSupabase å•Ÿå‹•å¤±æ•—

**æª¢æŸ¥ Supabase ç‹€æ…‹ï¼š**
```bash
supabase status
```

**æ‰‹å‹•å•Ÿå‹• Supabaseï¼š**
```bash
cd /home/dunren/cursor/webtodispatch/WebToDispatch_2
supabase start
```

**æª¢æŸ¥ Docker æ˜¯å¦é‹è¡Œï¼š**
```bash
docker ps
```

### å•é¡Œ 3ï¼šç«¯å£è¢«å ç”¨

**æª¢æŸ¥ç«¯å£å ç”¨ï¼š**
```bash
# æª¢æŸ¥ 3050 ç«¯å£ï¼ˆå‰ç«¯ï¼‰
sudo lsof -i :3050

# æª¢æŸ¥ 54321 ç«¯å£ï¼ˆSupabase APIï¼‰
sudo lsof -i :54321
```

**åœæ­¢å ç”¨ç«¯å£çš„é€²ç¨‹ï¼š**
```bash
sudo kill -9 <PID>
```

### å•é¡Œ 4ï¼šæ¬Šé™å•é¡Œ

**ç¢ºä¿å•Ÿå‹•è…³æœ¬æœ‰åŸ·è¡Œæ¬Šé™ï¼š**
```bash
chmod +x /home/dunren/cursor/webtodispatch/WebToDispatch_2/start_service.sh
```

**æª¢æŸ¥æœå‹™æ–‡ä»¶ä¸­çš„ç”¨æˆ¶è¨­å®šï¼š**
```bash
cat /etc/systemd/system/webtodispatch.service
```

ç¢ºä¿ `User` å’Œ `Group` è¨­å®šæ­£ç¢ºï¼ˆç•¶å‰ç‚º `dunren`ï¼‰ã€‚

## ğŸ“ æ–‡ä»¶èªªæ˜

- **`start_service.sh`** - æœå‹™å•Ÿå‹•è…³æœ¬
  - æª¢æŸ¥ä¸¦å•Ÿå‹• Supabase
  - æª¢æŸ¥ç’°å¢ƒè®Šæ•¸å’Œä¾è³´
  - å•Ÿå‹•å‰ç«¯é–‹ç™¼ä¼ºæœå™¨

- **`webtodispatch.service`** - systemd æœå‹™é…ç½®æ–‡ä»¶
  - å®šç¾©æœå‹™è¡Œç‚º
  - è¨­å®šè‡ªå‹•é‡å•Ÿ
  - é…ç½®æ—¥èªŒè¼¸å‡º

- **`å®‰è£é–‹æ©Ÿè‡ªå‹•å•Ÿå‹•.sh`** - è‡ªå‹•å®‰è£è…³æœ¬
  - ç°¡åŒ–å®‰è£éç¨‹
  - è‡ªå‹•å®Œæˆæ‰€æœ‰è¨­å®šæ­¥é©Ÿ

- **`service.log`** - æœå‹™é‹è¡Œæ—¥èªŒ
  - è¨˜éŒ„æœå‹™å•Ÿå‹•éç¨‹
  - è¨˜éŒ„éŒ¯èª¤è¨Šæ¯

## âš™ï¸ æœå‹™é…ç½®èªªæ˜

æœå‹™é…ç½®åœ¨ `webtodispatch.service` æ–‡ä»¶ä¸­ï¼š

```ini
[Unit]
Description=WebToDispatch ä»»å‹™äº¤è¾¦ç³»çµ±æœå‹™
After=network.target docker.service
Wants=network-online.target

[Service]
Type=simple
User=dunren
Group=dunren
WorkingDirectory=/home/dunren/cursor/webtodispatch/WebToDispatch_2
ExecStart=/home/dunren/cursor/webtodispatch/WebToDispatch_2/start_service.sh
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

**é…ç½®èªªæ˜ï¼š**
- `After=network.target docker.service` - ç­‰å¾…ç¶²è·¯å’Œ Docker æœå‹™å•Ÿå‹•å¾Œå†å•Ÿå‹•
- `Restart=always` - æœå‹™ç•°å¸¸é€€å‡ºæ™‚è‡ªå‹•é‡å•Ÿ
- `RestartSec=10` - é‡å•Ÿå‰ç­‰å¾… 10 ç§’
- `Type=simple` - ç°¡å–®æœå‹™é¡å‹ï¼ŒExecStart é€²ç¨‹ç‚ºä¸»é€²ç¨‹

## âœ… é©—è­‰æœå‹™é‹è¡Œ

1. **æª¢æŸ¥æœå‹™ç‹€æ…‹**
   ```bash
   sudo systemctl status webtodispatch
   ```
   æ‡‰è©²é¡¯ç¤º `active (running)`

2. **æª¢æŸ¥å‰ç«¯æœå‹™**
   ```bash
   curl http://localhost:3050
   ```
   æˆ–ç€è¦½å™¨è¨ªå• `http://localhost:3050`

3. **æª¢æŸ¥ Supabase API**
   ```bash
   curl http://localhost:54321/rest/v1/
   ```

4. **æŸ¥çœ‹æ—¥èªŒç¢ºèªç„¡éŒ¯èª¤**
   ```bash
   sudo journalctl -u webtodispatch -n 50
   ```

## ğŸ”„ æ›´æ–°æœå‹™é…ç½®

å¦‚æœä¿®æ”¹äº†æœå‹™é…ç½®ï¼ˆ`webtodispatch.service`ï¼‰ï¼Œéœ€è¦ï¼š

1. **é‡æ–°è¤‡è£½æœå‹™æ–‡ä»¶**
   ```bash
   sudo cp webtodispatch.service /etc/systemd/system/
   ```

2. **é‡æ–°è¼‰å…¥ systemd**
   ```bash
   sudo systemctl daemon-reload
   ```

3. **é‡å•Ÿæœå‹™**
   ```bash
   sudo systemctl restart webtodispatch
   ```

## ğŸ“ éœ€è¦å¹«åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°å•é¡Œï¼Œè«‹ï¼š
1. æŸ¥çœ‹æœå‹™æ—¥èªŒï¼š`sudo journalctl -u webtodispatch -f`
2. æŸ¥çœ‹æœå‹™ç‹€æ…‹ï¼š`sudo systemctl status webtodispatch`
3. æª¢æŸ¥æœå‹™æ—¥èªŒæ–‡ä»¶ï¼š`tail -f service.log`

