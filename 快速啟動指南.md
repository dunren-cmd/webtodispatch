# 快速啟動指南

## 適用於：從 Git 拉取代碼後快速啟動

### 步驟 1：安裝依賴

```bash
npm install
```

### 步驟 2：設定環境變數

```bash
# Windows
copy .env.example .env

# Linux/Mac
cp .env.example .env
```

編輯 `.env` 文件，修改 Supabase 配置：

```env
VITE_SUPABASE_URL=http://你的IP:54321
VITE_SUPABASE_ANON_KEY=你的Supabase_ANON_KEY
```

**如何取得 Supabase 配置：**

1. 啟動 Supabase：
   ```bash
   supabase start
   ```

2. 查看配置：
   ```bash
   supabase status
   ```

3. 複製 `API URL` 和 `anon key` 到 `.env` 文件

### 步驟 3：執行資料庫遷移

**確保資料庫結構一致：**

```bash
# 執行所有遷移文件
supabase migration up
```

或在 Supabase Studio 中：
1. 打開 Supabase Studio：`http://localhost:54323`
2. 進入 SQL Editor
3. 按順序執行 `supabase/migrations/` 目錄中的所有 `.sql` 文件

**遷移文件順序：**
1. `20251212134638_init.sql` - 創建 users 和 tasks 表
2. `20251212170000_merge_personnel_to_users.sql` - 添加 mail, employee_id, headshot
3. `20251213000000_change_avatar_to_level.sql` - 添加 level，移除 avatar
4. `20251213120000_update_level5_to_level4.sql` - 更新 level 5 為 4
5. `20251214000000_fix_users_table_structure.sql` - 修復 users 表結構
6. `20251215000000_create_roles_table.sql` - 創建 roles 表並建立關聯

### 步驟 4：啟動應用

```bash
npm run dev
```

應用會在 `http://localhost:3050` 啟動（或你在 `.env` 中設定的端口）

### 步驟 5：驗證

1. **檢查瀏覽器控制台**
   - 應該看到環境配置資訊
   - 不應該有 Supabase 連接錯誤

2. **檢查資料庫**
   ```sql
   -- 在 Supabase Studio SQL Editor 中執行
   SELECT COUNT(*) FROM users;
   SELECT COUNT(*) FROM tasks;
   SELECT COUNT(*) FROM roles;
   ```

3. **測試功能**
   - 查看任務列表
   - 查看員工列表
   - 查看角色管理

## 完整啟動腳本

創建 `start.bat`（Windows）或 `start.sh`（Linux/Mac）：

**start.bat (Windows):**
```batch
@echo off
echo ========================================
echo 快速啟動任務交辦系統
echo ========================================
echo.

echo [1/4] 檢查環境變數...
if not exist ".env" (
    echo ⚠️  未找到 .env 文件，從範本創建...
    copy .env.example .env
    echo ✅ 已創建 .env 文件，請編輯後重新執行此腳本
    pause
    exit /b 1
)
echo ✅ .env 文件存在
echo.

echo [2/4] 安裝依賴...
call npm install
if errorlevel 1 (
    echo ❌ 安裝失敗！
    pause
    exit /b 1
)
echo ✅ 依賴安裝完成
echo.

echo [3/4] 檢查 Supabase 遷移...
echo 請確認已執行所有遷移文件：
echo   supabase migration up
echo.
pause

echo [4/4] 啟動應用...
call npm run dev
```

**start.sh (Linux/Mac):**
```bash
#!/bin/bash
echo "========================================"
echo "快速啟動任務交辦系統"
echo "========================================"
echo

echo "[1/4] 檢查環境變數..."
if [ ! -f ".env" ]; then
    echo "⚠️  未找到 .env 文件，從範本創建..."
    cp .env.example .env
    echo "✅ 已創建 .env 文件，請編輯後重新執行此腳本"
    exit 1
fi
echo "✅ .env 文件存在"
echo

echo "[2/4] 安裝依賴..."
npm install
if [ $? -ne 0 ]; then
    echo "❌ 安裝失敗！"
    exit 1
fi
echo "✅ 依賴安裝完成"
echo

echo "[3/4] 檢查 Supabase 遷移..."
echo "請確認已執行所有遷移文件："
echo "  supabase migration up"
echo
read -p "按 Enter 繼續..."

echo "[4/4] 啟動應用..."
npm run dev
```

## 故障排除

### 問題 1：Supabase 連接失敗

**解決方法：**
1. 檢查 Supabase 是否運行：`supabase status`
2. 檢查 `.env` 中的 URL 和 Key 是否正確
3. 檢查防火牆設定

### 問題 2：資料庫表不存在

**解決方法：**
1. 執行所有遷移文件：`supabase migration up`
2. 檢查遷移狀態：`supabase migration list`
3. 在 Supabase Studio 中手動執行遷移文件

### 問題 3：端口被占用

**解決方法：**
1. 修改 `.env` 中的 `VITE_APP_PORT`
2. 或停止占用端口的程序

### 問題 4：環境變數未生效

**解決方法：**
1. 確認變數名稱以 `VITE_` 開頭
2. 重新啟動開發伺服器
3. 清除瀏覽器快取

## 檢查清單

- [ ] 已執行 `npm install`
- [ ] 已複製 `.env.example` 為 `.env`
- [ ] 已修改 `.env` 中的 Supabase 配置
- [ ] 已執行 `supabase migration up`
- [ ] 已啟動 Supabase（`supabase start`）
- [ ] 已執行 `npm run dev`
- [ ] 瀏覽器控制台沒有錯誤
- [ ] 可以正常訪問應用
