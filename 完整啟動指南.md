# å®Œæ•´å•Ÿå‹•æŒ‡å— - ç¢ºä¿è³‡æ–™åº«è³‡æ–™å®Œå…¨ä¸€è‡´

## ğŸ¯ ç›®æ¨™

ç¢ºä¿å¾ Git æ‹‰å–ä»£ç¢¼å¾Œï¼Œåœ¨ä»»ä½•ç’°å¢ƒéƒ½èƒ½ï¼š
1. å¿«é€Ÿå•Ÿå‹•æ‡‰ç”¨
2. è³‡æ–™åº«çµæ§‹å®Œå…¨ä¸€è‡´
3. é…ç½®æ­£ç¢ºï¼ˆIPã€Supabase ä½å€ï¼‰

## ğŸ“‹ å®Œæ•´æ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šå¾ Git æ‹‰å–ä»£ç¢¼

```bash
git clone <ä½ çš„å€‰åº«URL>
cd WebToDispatch_2
```

### æ­¥é©Ÿ 2ï¼šå®‰è£ä¾è³´

```bash
npm install
```

### æ­¥é©Ÿ 3ï¼šè¨­å®šç’°å¢ƒè®Šæ•¸

**Windows:**
```bash
copy .env.example .env
```

**Linux/Mac:**
```bash
cp .env.example .env
```

### æ­¥é©Ÿ 4ï¼šå•Ÿå‹• Supabase

```bash
supabase start
```

**å–å¾—é…ç½®ï¼š**
```bash
supabase status
```

è¼¸å‡ºç¯„ä¾‹ï¼š
```
API URL: http://192.168.68.75:54321
anon key: sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH
```

### æ­¥é©Ÿ 5ï¼šç·¨è¼¯ .env æ–‡ä»¶

å°‡æ­¥é©Ÿ 4 å–å¾—çš„é…ç½®å¡«å…¥ `.env`ï¼š

```env
VITE_SUPABASE_URL=http://192.168.68.75:54321
VITE_SUPABASE_ANON_KEY=sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH
VITE_APP_PORT=3050
VITE_APP_HOST=0.0.0.0
```

**é‡è¦ï¼š**
- å¦‚æœ Supabase åœ¨ä¸åŒ IPï¼Œä¿®æ”¹ `VITE_SUPABASE_URL`
- æ¯å€‹ç’°å¢ƒçš„ `anon key` å¯èƒ½ä¸åŒï¼Œä½¿ç”¨ `supabase status` å–å¾—

### æ­¥é©Ÿ 6ï¼šåŸ·è¡Œè³‡æ–™åº«é·ç§»ï¼ˆé—œéµæ­¥é©Ÿï¼‰

**é€™ä¸€æ­¥ç¢ºä¿è³‡æ–™åº«çµæ§‹å®Œå…¨ä¸€è‡´ï¼**

```bash
supabase migration up
```

é€™æœƒåŸ·è¡Œ `supabase/migrations/` ç›®éŒ„ä¸­çš„æ‰€æœ‰é·ç§»æ–‡ä»¶ï¼š

1. âœ… `20251212134638_init.sql` - å‰µå»º users å’Œ tasks è¡¨
2. âœ… `20251212170000_merge_personnel_to_users.sql` - æ·»åŠ  mail, employee_id, headshot
3. âœ… `20251213000000_change_avatar_to_level.sql` - æ·»åŠ  levelï¼Œç§»é™¤ avatar
4. âœ… `20251213120000_update_level5_to_level4.sql` - æ›´æ–° level 5 ç‚º 4
5. âœ… `20251214000000_fix_users_table_structure.sql` - ä¿®å¾© users è¡¨çµæ§‹
6. âœ… `20251215000000_create_roles_table.sql` - å‰µå»º roles è¡¨ä¸¦å»ºç«‹é—œè¯

**é©—è­‰é·ç§»ï¼š**
```bash
supabase migration list
```

æ‰€æœ‰é·ç§»æ‡‰è©²æ¨™è¨˜ç‚ºå·²åŸ·è¡Œã€‚

### æ­¥é©Ÿ 7ï¼šé©—è­‰è³‡æ–™åº«çµæ§‹

åœ¨ Supabase Studio (`http://localhost:54323`) çš„ SQL Editor ä¸­åŸ·è¡Œï¼š

```sql
-- æª¢æŸ¥æ‰€æœ‰è¡¨
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public'
ORDER BY table_name;

-- æ‡‰è©²çœ‹åˆ°ï¼šusers, tasks, roles

-- æª¢æŸ¥å¤–éµé—œè¯
SELECT
  tc.constraint_name,
  tc.table_name,
  kcu.column_name,
  ccu.table_name AS foreign_table_name
FROM information_schema.table_constraints AS tc
JOIN information_schema.key_column_usage AS kcu
  ON tc.constraint_name = kcu.constraint_name
JOIN information_schema.constraint_column_usage AS ccu
  ON ccu.constraint_name = tc.constraint_name
WHERE tc.constraint_type = 'FOREIGN KEY'
  AND tc.table_schema = 'public';

-- æ‡‰è©²çœ‹åˆ°ï¼šfk_users_role
```

### æ­¥é©Ÿ 8ï¼šå•Ÿå‹•æ‡‰ç”¨

```bash
npm run dev
```

æ‡‰ç”¨æœƒåœ¨ `http://localhost:3050` å•Ÿå‹•ï¼ˆæˆ–ä½ åœ¨ `.env` ä¸­è¨­å®šçš„ç«¯å£ï¼‰

### æ­¥é©Ÿ 9ï¼šé©—è­‰æ‡‰ç”¨

1. **æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°**
   - æ‡‰è©²çœ‹åˆ°ç’°å¢ƒé…ç½®è³‡è¨Š
   - ä¸æ‡‰è©²æœ‰ Supabase é€£æ¥éŒ¯èª¤

2. **æ¸¬è©¦åŠŸèƒ½**
   - æŸ¥çœ‹ä»»å‹™åˆ—è¡¨
   - æŸ¥çœ‹å“¡å·¥åˆ—è¡¨
   - æŸ¥çœ‹è§’è‰²ç®¡ç†ï¼ˆæ‡‰è©²èƒ½çœ‹åˆ° Webhook è¨­å®šï¼‰

## ğŸ”„ ä¸åŒç’°å¢ƒçš„é…ç½®

### ç’°å¢ƒ Aï¼ˆIP: 192.168.68.75ï¼‰

```env
VITE_SUPABASE_URL=http://192.168.68.75:54321
VITE_SUPABASE_ANON_KEY=sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH
```

### ç’°å¢ƒ Bï¼ˆIP: 192.168.1.100ï¼‰

```env
VITE_SUPABASE_URL=http://192.168.1.100:54321
VITE_SUPABASE_ANON_KEY=å¾è©²ç’°å¢ƒçš„ supabase status å–å¾—
```

**é‡è¦ï¼š**
- æ¯å€‹ç’°å¢ƒçš„ Supabase IP å¯èƒ½ä¸åŒ
- æ¯å€‹ç’°å¢ƒçš„ `anon key` å¯èƒ½ä¸åŒ
- ä½¿ç”¨ `supabase status` å–å¾—ç•¶å‰ç’°å¢ƒçš„é…ç½®

## âœ… æª¢æŸ¥æ¸…å–®

æ‹‰å–ä»£ç¢¼å¾Œï¼Œå®Œæˆä»¥ä¸‹æª¢æŸ¥ï¼š

- [ ] å·²åŸ·è¡Œ `npm install`
- [ ] å·²è¤‡è£½ `.env.example` ç‚º `.env`
- [ ] å·²ä¿®æ”¹ `.env` ä¸­çš„ Supabase URLï¼ˆä½¿ç”¨ç•¶å‰ç’°å¢ƒçš„ IPï¼‰
- [ ] å·²ä¿®æ”¹ `.env` ä¸­çš„ Supabase ANON_KEYï¼ˆä½¿ç”¨ `supabase status` å–å¾—ï¼‰
- [ ] å·²å•Ÿå‹• Supabaseï¼š`supabase start`
- [ ] å·²åŸ·è¡Œé·ç§»ï¼š`supabase migration up`
- [ ] å·²é©—è­‰é·ç§»ç‹€æ…‹ï¼š`supabase migration list`
- [ ] å·²é©—è­‰è³‡æ–™åº«çµæ§‹ï¼ˆusers, tasks, roles è¡¨å­˜åœ¨ï¼‰
- [ ] å·²é©—è­‰å¤–éµé—œè¯ï¼ˆfk_users_role å­˜åœ¨ï¼‰
- [ ] å·²å•Ÿå‹•æ‡‰ç”¨ï¼š`npm run dev`
- [ ] ç€è¦½å™¨æ§åˆ¶å°æ²’æœ‰éŒ¯èª¤
- [ ] æ‡‰ç”¨åŠŸèƒ½æ­£å¸¸é‹ä½œ

## ğŸš€ ä¸€éµå•Ÿå‹•ï¼ˆä½¿ç”¨è…³æœ¬ï¼‰

### Windows

åŸ·è¡Œ `start.bat`ï¼Œæœƒè‡ªå‹•ï¼š
1. æª¢æŸ¥ä¸¦å‰µå»º `.env` æ–‡ä»¶
2. æª¢æŸ¥ Supabase ç‹€æ…‹
3. å®‰è£ä¾è³´
4. å•Ÿå‹•æ‡‰ç”¨

### Linux/Mac

å‰µå»º `start.sh`ï¼š

```bash
#!/bin/bash
# æª¢æŸ¥ä¸¦å‰µå»º .env
if [ ! -f ".env" ]; then
    cp .env.example .env
    echo "è«‹ç·¨è¼¯ .env æ–‡ä»¶å¾Œé‡æ–°åŸ·è¡Œ"
    exit 1
fi

# å®‰è£ä¾è³´
npm install

# å•Ÿå‹•æ‡‰ç”¨
npm run dev
```

## ğŸ“ é‡è¦æé†’

1. **ç’°å¢ƒè®Šæ•¸å¿…é ˆè¨­å®š**
   - `.env` æ–‡ä»¶ä¸æœƒæäº¤åˆ° Git
   - æ¯å€‹ç’°å¢ƒéœ€è¦è‡ªå·±å‰µå»º `.env` æ–‡ä»¶
   - åƒè€ƒ `.env.example` ä½œç‚ºç¯„æœ¬

2. **è³‡æ–™åº«é·ç§»å¿…é ˆåŸ·è¡Œ**
   - æ‰€æœ‰é·ç§»æ–‡ä»¶éƒ½åœ¨ `supabase/migrations/` ç›®éŒ„ä¸­
   - åŸ·è¡Œ `supabase migration up` ç¢ºä¿è³‡æ–™åº«çµæ§‹ä¸€è‡´
   - é·ç§»æ–‡ä»¶æœƒæäº¤åˆ° Gitï¼Œç¢ºä¿æ‰€æœ‰ç’°å¢ƒçµæ§‹ç›¸åŒ

3. **Supabase é…ç½®**
   - æ¯å€‹ç’°å¢ƒçš„ IP å’Œ Key å¯èƒ½ä¸åŒ
   - ä½¿ç”¨ `supabase status` å–å¾—ç•¶å‰ç’°å¢ƒçš„é…ç½®
   - ä¿®æ”¹ `.env` æ–‡ä»¶å³å¯åˆ‡æ›ç’°å¢ƒ

4. **è³‡æ–™ä¸€è‡´æ€§**
   - é·ç§»æ–‡ä»¶ç¢ºä¿è³‡æ–™åº«çµæ§‹ä¸€è‡´
   - è³‡æ–™å…§å®¹å¯èƒ½ä¸åŒï¼ˆå–æ±ºæ–¼å„ç’°å¢ƒçš„è³‡æ–™ï¼‰
   - çµæ§‹ï¼ˆè¡¨ã€æ¬„ä½ã€é—œè¯ï¼‰æœƒå®Œå…¨ä¸€è‡´

## ğŸ› å¸¸è¦‹å•é¡Œ

### Q1: å¦‚ä½•çŸ¥é“ Supabase çš„ IP å’Œ Keyï¼Ÿ

**A:** åŸ·è¡Œ `supabase status`ï¼Œæœƒé¡¯ç¤ºï¼š
```
API URL: http://192.168.68.75:54321
anon key: sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH
```

### Q2: ç‚ºä»€éº¼è¦åŸ·è¡Œé·ç§»ï¼Ÿ

**A:** é·ç§»æ–‡ä»¶å®šç¾©äº†è³‡æ–™åº«çµæ§‹ã€‚åŸ·è¡Œé·ç§»ç¢ºä¿ï¼š
- æ‰€æœ‰è¡¨éƒ½å­˜åœ¨
- æ‰€æœ‰æ¬„ä½éƒ½æ­£ç¢º
- æ‰€æœ‰é—œè¯éƒ½å»ºç«‹
- è³‡æ–™åº«çµæ§‹å®Œå…¨ä¸€è‡´

### Q3: å¦‚æœ Supabase åœ¨ä¸åŒ IP æ€éº¼è¾¦ï¼Ÿ

**A:** ä¿®æ”¹ `.env` æ–‡ä»¶ä¸­çš„ `VITE_SUPABASE_URL`ï¼š
```env
VITE_SUPABASE_URL=http://æ–°çš„IP:54321
```
ç„¶å¾Œé‡æ–°å•Ÿå‹•æ‡‰ç”¨ã€‚

### Q4: å¦‚ä½•ç¢ºä¿è³‡æ–™åº«è³‡æ–™å®Œå…¨ä¸€æ¨£ï¼Ÿ

**A:** 
1. åŸ·è¡Œæ‰€æœ‰é·ç§»æ–‡ä»¶ï¼š`supabase migration up`
2. é·ç§»æ–‡ä»¶æœƒå‰µå»ºç›¸åŒçš„è¡¨çµæ§‹
3. è³‡æ–™å…§å®¹å¯èƒ½ä¸åŒï¼ˆå–æ±ºæ–¼å„ç’°å¢ƒï¼‰
4. çµæ§‹æœƒå®Œå…¨ä¸€è‡´

### Q5: .env æ–‡ä»¶æœƒè¢«æäº¤åˆ° Git å—ï¼Ÿ

**A:** ä¸æœƒã€‚`.env` å·²åœ¨ `.gitignore` ä¸­æ’é™¤ã€‚`.env.example` æœƒæäº¤ï¼Œä½œç‚ºç¯„æœ¬ã€‚
