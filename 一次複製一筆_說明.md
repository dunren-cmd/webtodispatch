# 一次複製一筆資料的說明

## 🎯 最簡單的方法：一次處理一筆

這個方法最簡單，每次只處理一筆資料，不容易出錯。

---

## 📋 執行步驟

### 第一次執行（設定）

1. **打開 Supabase SQL Editor**
2. **執行添加欄位的 SQL**（只需要執行一次）：
   ```sql
   ALTER TABLE users ADD COLUMN IF NOT EXISTS mail TEXT;
   ```

### 之後每次複製一筆資料

#### 步驟 1：查看 PersonnelData 的資料

在 SQL Editor 執行：

```sql
SELECT 
  id,
  name,
  "JobTitle",
  "Mail"
FROM "PersonnelData"
ORDER BY id
LIMIT 1;
```

這會顯示第一筆資料。

#### 步驟 2：複製這筆資料

根據步驟 1 的結果，修改下面的 SQL：

```sql
INSERT INTO users (id, name, role, mail, timestamp)
VALUES (
  1234567890,              -- 改成步驟 1 顯示的 id
  '程于宣',                -- 改成步驟 1 顯示的 name
  '護理師',                -- 改成步驟 1 顯示的 JobTitle
  'shan3636@gmail.com',    -- 改成步驟 1 顯示的 Mail
  NOW()
)
ON CONFLICT (id) 
DO UPDATE SET
  name = EXCLUDED.name,
  role = EXCLUDED.role,
  mail = EXCLUDED.mail;
```

#### 步驟 3：驗證

```sql
SELECT id, name, role, mail
FROM users
WHERE id = 1234567890;  -- 改成剛才的 id
```

如果看到資料，表示成功！

#### 步驟 4：處理下一筆

修改步驟 1 的 SQL，加上 `OFFSET`：

```sql
SELECT 
  id,
  name,
  "JobTitle",
  "Mail"
FROM "PersonnelData"
ORDER BY id
LIMIT 1 OFFSET 1;  -- OFFSET 1 = 第二筆，OFFSET 2 = 第三筆，以此類推
```

然後重複步驟 2-3。

---

## 📝 範例：複製第一筆資料

假設 PersonnelData 的第一筆資料是：
- id: `1234567890`
- name: `程于宣`
- JobTitle: `護理師`
- Mail: `shan3636@gmail.com`

執行：

```sql
INSERT INTO users (id, name, role, mail, timestamp)
VALUES (
  1234567890,
  '程于宣',
  '護理師',
  'shan3636@gmail.com',
  NOW()
)
ON CONFLICT (id) 
DO UPDATE SET
  name = EXCLUDED.name,
  role = EXCLUDED.role,
  mail = EXCLUDED.mail;
```

---

## 💡 小技巧

### 技巧 1：查看所有資料

如果想一次看到所有資料：

```sql
SELECT 
  id,
  name,
  "JobTitle",
  "Mail"
FROM "PersonnelData"
ORDER BY id;
```

然後逐筆複製。

### 技巧 2：查看還剩幾筆

查看還有多少筆沒複製：

```sql
SELECT 
  COUNT(*) as total_personnel,
  COUNT(u.id) as already_copied,
  COUNT(*) - COUNT(u.id) as remaining
FROM "PersonnelData" p
LEFT JOIN users u ON p.id = u.id;
```

### 技巧 3：查看還沒複製的資料

```sql
SELECT 
  p.id,
  p.name,
  p."JobTitle",
  p."Mail"
FROM "PersonnelData" p
LEFT JOIN users u ON p.id = u.id
WHERE u.id IS NULL
ORDER BY p.id;
```

---

## ⚠️ 注意事項

1. **字串要用單引號**：`'程于宣'` 不是 `程于宣`
2. **數字不用引號**：`1234567890` 不是 `'1234567890'`
3. **如果 id 已存在**：會自動更新，不會重複插入
4. **如果出錯**：檢查單引號、逗號是否正確

---

## ✅ 完成後驗證

所有資料複製完成後，執行：

```sql
SELECT 
  COUNT(*) as total_personnel,
  COUNT(u.id) as copied_to_users
FROM "PersonnelData" p
LEFT JOIN users u ON p.id = u.id;
```

如果 `total_personnel` 和 `copied_to_users` 數量相同，表示全部複製成功！
