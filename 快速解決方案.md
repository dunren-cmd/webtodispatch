# 快速解決方案：UPDATE 語句 API 錯誤

## 📋 重要說明

**這個錯誤與 API Key 設定無關！**

這個 "API error happened while trying to communicate with the server" 錯誤是 Supabase Dashboard 的 SQL Editor 與資料庫伺服器的通訊問題。

---

## ✅ 立即解決方案

### 方案一：使用 Table Editor（最推薦）

如果 SQL Editor 一直出錯，直接使用 Table Editor 手動操作：

#### 添加 ID 欄位

1. 開啟 Supabase Dashboard：`http://192.168.62.101:54323`
2. 左側選單 → **Table Editor**
3. 選擇 **PersonnelData** 表
4. 點擊表格上方的 **欄位** 或 **Columns** 圖示
5. 點擊 **+ Add column** 或 **新增欄位**
6. 填入：
   - **Name**: `id`
   - **Type**: `int8` 或 `bigint`
   - **Nullable**: ✅ 勾選
7. 點擊 **Save**

#### 生成 ID 值

**方法 1：手動填入（如果記錄不多）**

在 Table Editor 中，為每筆記錄的 `id` 欄位填入 10 位數亂數（例如：1234567890）

**方法 2：稍後用 SQL（等 SQL Editor 恢復）**

等 SQL Editor 恢復正常後，執行：

```sql
UPDATE "PersonnelData" 
SET id = FLOOR(RANDOM() * 9000000000 + 1000000000)::BIGINT 
WHERE id IS NULL;
```

---

### 方案二：檢查 Supabase 服務

在 PowerShell 中執行：

```powershell
supabase status
```

**如果 Supabase 沒有運行：**

```powershell
supabase start
```

等待啟動完成（約 30-60 秒），然後重新嘗試 SQL Editor。

---

### 方案三：重新整理頁面

1. 按 `Ctrl + F5` 強制重新整理
2. 或清除瀏覽器快取後重新整理
3. 重新嘗試執行 SQL

---

## 🔍 為什麼會出現這個錯誤？

可能的原因：
1. ✅ Supabase 服務暫時未響應
2. ✅ 瀏覽器與 Supabase 的連線問題
3. ✅ Supabase Dashboard 的暫時性錯誤
4. ✅ 網路連線不穩定

**這不是：**
- ❌ API Key 未設定的問題
- ❌ SQL 語法錯誤
- ❌ 權限問題

---

## 💡 建議做法

**如果急需完成任務：**

1. **使用 Table Editor 手動添加欄位** ← 最可靠的方法
2. **手動填入 ID 或稍後用 SQL 生成**

**如果不急：**

1. 重新啟動 Supabase：`supabase stop` 然後 `supabase start`
2. 等待幾分鐘後重試 SQL Editor
3. 清除瀏覽器快取後重試

---

## 📝 關於 API Key 的說明

**SQL Editor 不需要設定 API Key！**

- SQL Editor 使用 Supabase Dashboard 的內部認證
- API Key 是用於：
  - 前端應用程式（api.ts）
  - Google Apps Script（Code.gs）
  - REST API 請求

您的 API Key 已經設定在 `api.ts` 和 `Code.gs` 中，不需要在 SQL Editor 中設定。

---

**快速檢查：可以執行簡單的 SELECT 嗎？**

```sql
SELECT 1;
```

如果這個都無法執行，表示是連接問題，請先檢查 Supabase 服務狀態。
