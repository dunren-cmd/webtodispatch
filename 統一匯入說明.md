# çµ±ä¸€ CSV åŒ¯å…¥ Supabase èªªæ˜

## ğŸ“‹ åŠŸèƒ½èªªæ˜

é€™å€‹è…³æœ¬å¯ä»¥ä¸€æ¬¡æ€§åŒ¯å…¥ä¸‰å€‹ CSV æª”æ¡ˆåˆ° Supabaseï¼š
- **roles_rows.csv** â†’ `roles` è¡¨
- **users_rows (2).csv** â†’ `users` è¡¨  
- **tasks_rows.csv** â†’ `tasks` è¡¨

**é‡è¦**ï¼šåŒ¯å…¥é †åºæ˜¯å›ºå®šçš„ï¼š`roles` â†’ `users` â†’ `tasks`ï¼Œå› ç‚º `users.role` æ˜¯å¤–éµåˆ° `roles.id`ã€‚

## ğŸ”§ å‰ç½®éœ€æ±‚

### 1. Python ç’°å¢ƒ

```bash
python3 --version
```

### 2. å®‰è£ä¾è³´

```bash
pip install requests
```

### 3. Supabase æœå‹™é‹è¡Œä¸­

```bash
cd WebToDispatch_2
supabase status
```

å¦‚æœæ²’æœ‰é‹è¡Œï¼š

```bash
supabase start
```

## ğŸ“ CSV æª”æ¡ˆæ ¼å¼

### roles_rows.csv æ¬„ä½

| æ¬„ä½åç¨± | é¡å‹ | å¿…å¡« | èªªæ˜ |
|---------|------|------|------|
| id | æ–‡å­— | æ˜¯ | è§’è‰² IDï¼ˆä¸»éµï¼‰ |
| name | æ–‡å­— | å¦ | è§’è‰²åç¨±ï¼ˆå¦‚æœæ²’æœ‰æœƒä½¿ç”¨ idï¼‰ |
| icon_name | æ–‡å­— | å¦ | åœ–ç¤ºåç¨±ï¼ˆé è¨­ï¼šBriefcaseï¼‰ |
| color | æ–‡å­— | å¦ | é¡è‰²ä¸»é¡Œï¼ˆé è¨­ï¼šbg-blue-100 text-blue-700ï¼‰ |
| level | æ•´æ•¸ | å¦ | å±¤ç´š 1-4ï¼ˆé è¨­ï¼š4ï¼‰ |
| webhook | æ–‡å­— | å¦ | Webhook URL |
| is_default | å¸ƒæ— | å¦ | æ˜¯å¦ç‚ºé è¨­è§’è‰²ï¼ˆé è¨­ï¼šfalseï¼‰ |

**ç¯„ä¾‹**ï¼š
```csv
id,name,icon_name,color,level,webhook,is_default
ç®¡ç†,ç®¡ç†å±¤,Briefcase,bg-blue-100 text-blue-700,1,,false
è²¡å‹™,è²¡å‹™éƒ¨é–€,Calculator,bg-green-100 text-green-700,2,,false
```

### users_rows (2).csv æ¬„ä½

| æ¬„ä½åç¨± | é¡å‹ | å¿…å¡« | èªªæ˜ |
|---------|------|------|------|
| id | æ•´æ•¸ | å¦ | ç”¨æˆ¶ IDï¼ˆå¦‚æœæ²’æœ‰æœƒè‡ªå‹•ç”Ÿæˆï¼‰ |
| name | æ–‡å­— | æ˜¯ | å§“å |
| role | æ–‡å­— | å¦ | è§’è‰² IDï¼ˆå¿…é ˆå­˜åœ¨æ–¼ roles è¡¨ï¼‰ |
| level | æ•´æ•¸ | å¦ | å±¤ç´š 1-4ï¼ˆé è¨­ï¼š4ï¼Œ5 æœƒè‡ªå‹•æ”¹ç‚º 4ï¼‰ |
| mail | æ–‡å­— | å¦ | é›»å­éƒµä»¶ |
| employee_id | æ–‡å­— | å¦ | å“¡å·¥ ID |
| headshot | æ–‡å­— | å¦ | é ­åƒ/ç…§ç‰‡é€£çµ |

**ç¯„ä¾‹**ï¼š
```csv
id,name,role,level,mail,employee_id,headshot
1001,å¼µä¸‰,ç®¡ç†,1,zhang@example.com,E001,https://example.com/photo1.jpg
2001,æå››,è²¡å‹™,2,li@example.com,E002,
```

### tasks_rows.csv æ¬„ä½

| æ¬„ä½åç¨± | é¡å‹ | å¿…å¡« | èªªæ˜ |
|---------|------|------|------|
| id | æ•´æ•¸ | å¦ | ä»»å‹™ IDï¼ˆå¦‚æœæ²’æœ‰æœƒè‡ªå‹•ç”Ÿæˆï¼‰ |
| title | æ–‡å­— | æ˜¯ | ä»»å‹™æ¨™é¡Œ |
| description | æ–‡å­— | å¦ | ä»»å‹™æè¿° |
| assigner_id | æ•´æ•¸ | å¦ | äº¤è¾¦äºº ID |
| assigner_name | æ–‡å­— | å¦ | äº¤è¾¦äººå§“å |
| assignee_id | æ•´æ•¸ | å¦ | æ‰¿è¾¦äºº ID |
| assignee_name | æ–‡å­— | å¦ | æ‰¿è¾¦äººå§“å |
| collaborator_ids | JSON/æ–‡å­— | å¦ | å”ä½œè€… ID åˆ—è¡¨ |
| role_category | æ–‡å­— | å¦ | è§’è‰²é¡åˆ¥ |
| plan_date | æ—¥æœŸ | å¦ | è¨ˆåŠƒæ—¥æœŸ |
| interim_date | æ—¥æœŸ | å¦ | æœŸä¸­æ—¥æœŸ |
| final_date | æ—¥æœŸ | å¦ | æœ€çµ‚æ—¥æœŸ |
| status | æ–‡å­— | å¦ | ç‹€æ…‹ï¼ˆpending/in_progress/done/overdueï¼‰ |
| assignee_response | æ–‡å­— | å¦ | æ‰¿è¾¦äººå›è¦† |
| evidence | JSON/æ–‡å­— | å¦ | ä½è­‰è³‡æ–™ |

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1ï¼šä¸€æ¬¡æ€§åŒ¯å…¥ä¸‰å€‹æª”æ¡ˆ

```bash
cd /home/dunren/cursor/webtodispatch/WebToDispatch_2

python3 import_all_csv_to_supabase.py \
  --roles "/path/to/roles_rows.csv" \
  --users "/path/to/users_rows (2).csv" \
  --tasks "/path/to/tasks_rows.csv"
```

### æ–¹æ³• 2ï¼šåªåŒ¯å…¥éƒ¨åˆ†æª”æ¡ˆ

```bash
# åªåŒ¯å…¥ roles
python3 import_all_csv_to_supabase.py --roles roles_rows.csv

# åªåŒ¯å…¥ users å’Œ tasks
python3 import_all_csv_to_supabase.py \
  --users "users_rows (2).csv" \
  --tasks tasks_rows.csv
```

### æ–¹æ³• 3ï¼šä½¿ç”¨ç’°å¢ƒè®Šæ•¸è¨­å®š Supabase

```bash
export SUPABASE_URL=http://192.168.62.101:54321
export SUPABASE_ANON_KEY=sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH

python3 import_all_csv_to_supabase.py \
  --roles roles_rows.csv \
  --users "users_rows (2).csv" \
  --tasks tasks_rows.csv
```

### æ–¹æ³• 4ï¼šæŒ‡å®š Supabase URL å’Œ Key

```bash
python3 import_all_csv_to_supabase.py \
  --url http://192.168.62.101:54321 \
  --key sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH \
  --roles roles_rows.csv \
  --users "users_rows (2).csv" \
  --tasks tasks_rows.csv
```

## ğŸ“ å®Œæ•´åƒæ•¸èªªæ˜

```bash
python3 import_all_csv_to_supabase.py [é¸é …]

é¸é …ï¼š
  --roles FILE          roles CSV æª”æ¡ˆè·¯å¾‘
  --users FILE          users CSV æª”æ¡ˆè·¯å¾‘
  --tasks FILE          tasks CSV æª”æ¡ˆè·¯å¾‘
  --url URL             Supabase URLï¼ˆé è¨­ï¼šhttp://192.168.62.101:54321ï¼‰
  --key KEY             Supabase Anon Key
  --batch-size SIZE     æ‰¹æ¬¡å¤§å°ï¼ˆé è¨­ï¼š10ï¼‰
  -h, --help            é¡¯ç¤ºèªªæ˜
```

## âš ï¸ é‡è¦æ³¨æ„äº‹é …

### 1. åŒ¯å…¥é †åº

è…³æœ¬æœƒæŒ‰ç…§ä»¥ä¸‹é †åºåŒ¯å…¥ï¼š
1. **roles**ï¼ˆå¿…é ˆå…ˆåŒ¯å…¥ï¼‰
2. **users**ï¼ˆä¾è³´ rolesï¼‰
3. **tasks**ï¼ˆä¾è³´ usersï¼‰

é€™æ˜¯å› ç‚º `users.role` æ˜¯å¤–éµåˆ° `roles.id`ï¼Œæ‰€ä»¥å¿…é ˆå…ˆæœ‰ roles æ‰èƒ½åŒ¯å…¥ usersã€‚

### 2. ID è¡çªè™•ç†

- å¦‚æœ CSV ä¸­çš„ ID å·²å­˜åœ¨æ–¼è³‡æ–™åº«ä¸­ï¼Œè…³æœ¬æœƒå˜—è©¦**æ›´æ–°**è©²è¨˜éŒ„ï¼Œè€Œä¸æ˜¯å»ºç«‹æ–°è¨˜éŒ„
- å°æ–¼ rolesï¼šä½¿ç”¨ `id` æ¬„ä½åˆ¤æ–·
- å°æ–¼ users å’Œ tasksï¼šä½¿ç”¨ `id` æ¬„ä½åˆ¤æ–·

### 3. å¤–éµé©—è­‰

- åŒ¯å…¥ users æ™‚ï¼Œå¦‚æœ `role` æ¬„ä½çš„å€¼ä¸å­˜åœ¨æ–¼ roles è¡¨ä¸­ï¼Œæœƒå°è‡´åŒ¯å…¥å¤±æ•—
- å»ºè­°å…ˆç¢ºèª roles CSV ä¸­çš„æ‰€æœ‰è§’è‰²éƒ½å·²æˆåŠŸåŒ¯å…¥

### 4. Level æ¬„ä½è™•ç†

- **users.level**ï¼šå¦‚æœå€¼æ˜¯ 5ï¼Œæœƒè‡ªå‹•æ”¹ç‚º 4
- **roles.level** å’Œ **users.level**ï¼šå¿…é ˆåœ¨ 1-4 ç¯„åœå…§ï¼Œè¶…å‡ºç¯„åœæœƒè‡ªå‹•èª¿æ•´

### 5. CSV æª”æ¡ˆè·¯å¾‘

å¦‚æœæª”æ¡ˆåç¨±åŒ…å«ç©ºæ ¼ï¼ˆå¦‚ `users_rows (2).csv`ï¼‰ï¼Œè«‹ç”¨å¼•è™Ÿæ‹¬èµ·ä¾†ï¼š

```bash
--users "users_rows (2).csv"
```

## ğŸ” å¾ Windows è¤‡è£½æª”æ¡ˆåˆ° Linux

å¦‚æœ CSV æª”æ¡ˆåœ¨ Windows ç³»çµ±ä¸Šï¼ˆ`c:\Users\dunre\Desktop\`ï¼‰ï¼Œéœ€è¦å…ˆè¤‡è£½åˆ° Linuxï¼š

### æ–¹æ³• 1ï¼šä½¿ç”¨ SCPï¼ˆå¦‚æœå…©å°é›»è…¦åœ¨åŒä¸€ç¶²è·¯ï¼‰

åœ¨ Windows PowerShell ä¸­ï¼š

```powershell
scp "c:\Users\dunre\Desktop\roles_rows.csv" user@linux-ip:/home/dunren/cursor/webtodispatch/WebToDispatch_2/
scp "c:\Users\dunre\Desktop\users_rows (2).csv" user@linux-ip:/home/dunren/cursor/webtodispatch/WebToDispatch_2/
scp "c:\Users\dunre\Desktop\tasks_rows.csv" user@linux-ip:/home/dunren/cursor/webtodispatch/WebToDispatch_2/
```

### æ–¹æ³• 2ï¼šä½¿ç”¨å…±äº«è³‡æ–™å¤¾

å¦‚æœ Linux å¯ä»¥å­˜å– Windows å…±äº«è³‡æ–™å¤¾ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è·¯å¾‘ã€‚

### æ–¹æ³• 3ï¼šä½¿ç”¨ WSLï¼ˆWindows Subsystem for Linuxï¼‰

å¦‚æœæ˜¯åœ¨ Windows ä¸Šä½¿ç”¨ WSLï¼š

```bash
# åœ¨ WSL ä¸­
cp /mnt/c/Users/dunre/Desktop/roles_rows.csv ~/cursor/webtodispatch/WebToDispatch_2/
cp "/mnt/c/Users/dunre/Desktop/users_rows (2).csv" ~/cursor/webtodispatch/WebToDispatch_2/
cp /mnt/c/Users/dunre/Desktop/tasks_rows.csv ~/cursor/webtodispatch/WebToDispatch_2/
```

## ğŸ“Š åŸ·è¡Œç¯„ä¾‹

```bash
$ python3 import_all_csv_to_supabase.py \
    --roles roles_rows.csv \
    --users "users_rows (2).csv" \
    --tasks tasks_rows.csv

============================================================
ğŸ“¥ é–‹å§‹åŒ¯å…¥ CSV åˆ° Supabase
============================================================
ğŸŒ Supabase URLï¼šhttp://192.168.62.101:54321
ğŸ“Š æ‰¹æ¬¡å¤§å°ï¼š10

============================================================
1ï¸âƒ£  åŒ¯å…¥ roles è¡¨
============================================================
ğŸ“‹ è®€å–åˆ° 5 è¡Œ
âœ… è½‰æ›æˆåŠŸ 5 ç­†

  ğŸ“¦ æ‰¹æ¬¡ 1/1ï¼ˆ5 ç­†ï¼‰ ... âœ… 5 ç­†

ğŸ“Š rolesï¼šæˆåŠŸ 5 ç­†ï¼Œå¤±æ•— 0 ç­†

============================================================
2ï¸âƒ£  åŒ¯å…¥ users è¡¨
============================================================
ğŸ“‹ è®€å–åˆ° 20 è¡Œ
âœ… è½‰æ›æˆåŠŸ 20 ç­†

  ğŸ“¦ æ‰¹æ¬¡ 1/2ï¼ˆ10 ç­†ï¼‰ ... âœ… 10 ç­†
  ğŸ“¦ æ‰¹æ¬¡ 2/2ï¼ˆ10 ç­†ï¼‰ ... âœ… 10 ç­†

ğŸ“Š usersï¼šæˆåŠŸ 20 ç­†ï¼Œå¤±æ•— 0 ç­†

============================================================
3ï¸âƒ£  åŒ¯å…¥ tasks è¡¨
============================================================
ğŸ“‹ è®€å–åˆ° 15 è¡Œ
âœ… è½‰æ›æˆåŠŸ 15 ç­†

  ğŸ“¦ æ‰¹æ¬¡ 1/2ï¼ˆ10 ç­†ï¼‰ ... âœ… 10 ç­†
  ğŸ“¦ æ‰¹æ¬¡ 2/2ï¼ˆ5 ç­†ï¼‰ ... âœ… 5 ç­†

ğŸ“Š tasksï¼šæˆåŠŸ 15 ç­†ï¼Œå¤±æ•— 0 ç­†

============================================================
ğŸ“Š åŒ¯å…¥çµæœçµ±è¨ˆ
============================================================
âœ… ç¸½æˆåŠŸï¼š40 ç­†
âŒ ç¸½å¤±æ•—ï¼š0 ç­†

ğŸ‰ åŒ¯å…¥å®Œæˆï¼
```

## ğŸ› å¸¸è¦‹å•é¡Œ

### 1. å¤–éµéŒ¯èª¤

**éŒ¯èª¤è¨Šæ¯**ï¼š`foreign key constraint "fk_users_role"`

**åŸå› **ï¼šusers CSV ä¸­çš„ `role` å€¼ä¸å­˜åœ¨æ–¼ roles è¡¨ä¸­

**è§£æ±ºæ–¹æ³•**ï¼š
- ç¢ºèª roles CSV å·²æˆåŠŸåŒ¯å…¥
- æª¢æŸ¥ users CSV ä¸­çš„ `role` å€¼æ˜¯å¦èˆ‡ roles è¡¨ä¸­çš„ `id` å®Œå…¨ä¸€è‡´ï¼ˆå€åˆ†å¤§å°å¯«ï¼‰

### 2. CSV ç·¨ç¢¼å•é¡Œ

**éŒ¯èª¤è¨Šæ¯**ï¼š`UnicodeDecodeError`

**è§£æ±ºæ–¹æ³•**ï¼š
- ç¢ºä¿ CSV æª”æ¡ˆä½¿ç”¨ UTF-8 ç·¨ç¢¼
- å¦‚æœå¾ Excel åŒ¯å‡ºï¼Œé¸æ“‡ã€ŒUTF-8 CSVã€æ ¼å¼

### 3. æª”æ¡ˆè·¯å¾‘å•é¡Œ

**éŒ¯èª¤è¨Šæ¯**ï¼š`æ‰¾ä¸åˆ°æª”æ¡ˆ`

**è§£æ±ºæ–¹æ³•**ï¼š
- ä½¿ç”¨çµ•å°è·¯å¾‘
- å¦‚æœæª”æ¡ˆåç¨±åŒ…å«ç©ºæ ¼ï¼Œç”¨å¼•è™Ÿæ‹¬èµ·ä¾†
- ç¢ºèªæª”æ¡ˆç¢ºå¯¦å­˜åœ¨æ–¼æŒ‡å®šè·¯å¾‘

## ğŸ“š ç›¸é—œæ–‡ä»¶

- [CSV åŒ¯å…¥èªªæ˜](./CSVåŒ¯å…¥èªªæ˜.md)
- [Supabase è¨­å®šèªªæ˜](./SUPABASE_SETUP.md)
- [Supabase API éŒ¯èª¤æ’é™¤](./Supabase_APIéŒ¯èª¤æ’é™¤.md)

